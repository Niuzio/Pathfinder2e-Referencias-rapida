<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Editor PF2e – WYSIWYG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background:#0f1115; color:#e6e6e6; }
    header { padding: 10px; background:#12151b; display: flex; gap: 10px; align-items: center; }
    main { display: grid; grid-template-columns: 300px 1fr; height: calc(100vh - 50px); }
    aside { border-right: 1px solid #222; overflow: auto; padding: 10px; }
    section { padding: 10px; overflow: auto; }
    input, select, textarea { width: 100%; margin-bottom: 6px; padding: 6px; background:#12151b; color:#e6e6e6; border: 1px solid #273041; border-radius: 4px; }
    button { padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; }
    .primary { background:#1e88e5; color: white; }
    .danger { background:#c62828; color: white; }
    .card { border: 1px solid #222; padding: 8px; margin-bottom: 6px; border-radius: 4px; background:#0f131a; }
    #editor { background: white; color: black; }
  </style>
</head>
<body>
  <header>
    <input type="file" id="fileInput" accept=".js" multiple>
    <button id="exportBtn" class="primary">Exportar</button>
    <span id="status"></span>
  </header>

  <main id="app">
    <aside>
      <div v-for="(item, idx) in items" :key="idx" class="card" @click="selectItem(idx)" style="cursor:pointer">
        <div v-if="item.header">
          <strong>Sección:</strong> {{ item.header }}
        </div>
        <div v-else>
          <strong>{{ item.title }}</strong><br>
          <small>{{ item.icon }}</small>
        </div>
      </div>
    </aside>

    <section v-if="current">
      <div v-if="current.header">
        <label>Header</label>
        <input v-model="current.header">
      </div>
      <div v-else>
        <label>Título</label>
        <input v-model="current.title">
        <label>Icon</label>
        <input v-model="current.icon">
        <label>Subtitle</label>
        <input v-model="current.subtitle">
        <label>Reference</label>
        <input v-model="current.reference">
        <label>Descripción</label>
        <div id="editor"></div>
        <label>Bullets</label>
        <div v-for="(b, bi) in current.bullets" :key="bi" style="display:flex; gap:4px; margin-bottom:4px;">
          <input v-model="current.bullets[bi]">
          <button class="danger" @click.prevent="current.bullets.splice(bi,1)">X</button>
        </div>
        <button @click.prevent="current.bullets.push('')">Añadir bullet</button>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/acorn@8/dist/acorn.min.js"></script>
  <script src="https://unpkg.com/prettier@3/standalone.js"></script>
  <script src="https://unpkg.com/prettier@3/parser-babel.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          items: [],
          current: null,
          quill: null
        }
      },
      methods: {
        selectItem(i) {
          this.current = this.items[i];
          if (!this.current.header) {
            this.$nextTick(() => {
              const toolbarOptions = [
                [{ header: [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                ['blockquote', 'code-block'],
                [{ list: 'ordered' }, { list: 'bullet' }],
                [{ align: [] }],
                ['link', 'image'],
                ['clean']
              ];
              if (!this.quill) {
                this.quill = new Quill('#editor', {
                  theme: 'snow',
                  modules: { toolbar: toolbarOptions }
                });
                this.quill.on('text-change', () => {
                  this.current.description = this.quill.root.innerHTML;
                });
              }
              this.quill.root.innerHTML = this.current.description || '';
            });
          }
        },
        // aquí mantienes el resto de tus métodos originales (cargar, exportar, etc.)
      }
    }).mount('#app');
  </script>
</body>
</html>
